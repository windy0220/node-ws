<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON STRIKE: PIXEL WARS</title>
    <style>
        body {
            margin: 0;
            background-color: #050505;
            color: white;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            touch-action: none;
        }
        canvas {
            border: 4px solid #333;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
            image-rendering: pixelated; /* 关键：保持像素清晰 */
            max-width: 100%;
            max-height: 100%;
        }
        #ui-layer {
            position: absolute;
            pointer-events: none;
            width: 400px;
            height: 600px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .msg {
            font-size: 24px;
            text-shadow: 2px 2px #ff00ff;
            background: rgba(0,0,0,0.7);
            padding: 20px;
            border: 2px solid #0ff;
            display: none;
            text-align: center;
            pointer-events: auto;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <canvas id="gameCanvas"></canvas>
    <div id="ui-layer">
        <div id="start-screen" class="msg" style="display: block;">
            <h1>NEON STRIKE</h1>
            <p>PRESS TO START</p>
            <small>A/D or ARROWS to MOVE</small>
        </div>
        <div id="game-over" class="msg">
            <h1>GAME OVER</h1>
            <p id="final-score"></p>
            <p>RESTART</p>
        </div>
    </div>

<script>
/** @type {HTMLCanvasElement} */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const startScreen = document.getElementById('start-screen');
const gameOverScreen = document.getElementById('game-over');
const finalScoreText = document.getElementById('final-score');

canvas.width = 400;
canvas.height = 600;

// 游戏状态
let gameActive = false;
let score = 0;
let keys = {};
let particles = [];
let powerups = [];
let bullets = [];
let enemies = [];
let frame = 0;

// 玩家设置
const player = {
    x: 180,
    y: 520,
    w: 40,
    h: 40,
    speed: 5,
    lastShot: 0,
    shotDelay: 150,
    weaponLevel: 1,
    shield: false
};

// 监听按键
window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);

// 触屏支持
canvas.addEventListener('mousedown', e => handleTouch(e));
canvas.addEventListener('touchstart', e => handleTouch(e.touches[0]));
function handleTouch(e) {
    if(!gameActive) return;
    const rect = canvas.getBoundingClientRect();
    const touchX = e.clientX - rect.left;
    if(touchX < canvas.width / 2) keys['ArrowLeft'] = true;
    else keys['ArrowRight'] = true;
}
window.addEventListener('mouseup', () => { keys['ArrowLeft'] = false; keys['ArrowRight'] = false; });
window.addEventListener('touchend', () => { keys['ArrowLeft'] = false; keys['ArrowRight'] = false; });

// 初始化/重启
function init() {
    score = 0;
    bullets = [];
    enemies = [];
    particles = [];
    powerups = [];
    player.x = 180;
    player.weaponLevel = 1;
    player.shield = false;
    gameActive = true;
    startScreen.style.display = 'none';
    gameOverScreen.style.display = 'none';
    animate();
}

// 粒子特效
function createExplosion(x, y, color) {
    for(let i=0; i<8; i++) {
        particles.push({
            x, y,
            vx: (Math.random()-0.5)*6,
            vy: (Math.random()-0.5)*6,
            life: 20,
            color
        });
    }
}

// 游戏逻辑循环
function update() {
    if(!gameActive) return;
    frame++;

    // 移动
    if ((keys['ArrowLeft'] || keys['KeyA']) && player.x > 0) player.x -= player.speed;
    if ((keys['ArrowRight'] || keys['KeyD']) && player.x < canvas.width - player.w) player.x += player.speed;

    // 自动射击
    let now = Date.now();
    if (now - player.lastShot > player.shotDelay) {
        if(player.weaponLevel === 1) {
            bullets.push({x: player.x + 18, y: player.y, w: 4, h: 10, color: '#0ff'});
        } else {
            bullets.push({x: player.x + 5, y: player.y, w: 4, h: 10, color: '#f0f'});
            bullets.push({x: player.x + 31, y: player.y, w: 4, h: 10, color: '#f0f'});
        }
        player.lastShot = now;
    }

    // 子弹更新
    bullets.forEach((b, i) => {
        b.y -= 8;
        if(b.y < 0) bullets.splice(i, 1);
    });

    // 敌人生成
    if(frame % 40 === 0) {
        enemies.push({
            x: Math.random() * (canvas.width - 30),
            y: -30,
            w: 30,
            h: 30,
            hp: 2,
            color: `hsl(${Math.random()*360}, 70%, 50%)`
        });
    }

    // 敌人更新
    enemies.forEach((en, i) => {
        en.y += 2 + (score / 500); // 随分数增加难度
        
        // 碰撞检查 (子弹 vs 敌人)
        bullets.forEach((b, bi) => {
            if(b.x < en.x + en.w && b.x + b.w > en.x && b.y < en.y + en.h && b.y + b.h > en.y) {
                en.hp--;
                bullets.splice(bi, 1);
                createExplosion(en.x + en.w/2, en.y + en.h/2, en.color);
                if(en.hp <= 0) {
                    // 掉落补给
                    if(Math.random() < 0.2) {
                        powerups.push({x: en.x, y: en.y, w: 15, h: 15, type: Math.random() > 0.5 ? 'W' : 'S'});
                    }
                    enemies.splice(i, 1);
                    score += 10;
                }
            }
        });

        // 碰撞检查 (玩家 vs 敌人)
        if(en.x < player.x + player.w && en.x + en.w > player.x && en.y < player.y + player.h && en.y + en.h > player.y) {
            if(player.shield) {
                player.shield = false;
                enemies.splice(i, 1);
                createExplosion(player.x, player.y, '#fff');
            } else {
                endGame();
            }
        }

        if(en.y > canvas.height) enemies.splice(i, 1);
    });

    // 补给更新
    powerups.forEach((p, i) => {
        p.y += 2;
        if(p.x < player.x + player.w && p.x + p.w > player.x && p.y < player.y + player.h && p.y + p.h > player.y) {
            if(p.type === 'W') player.weaponLevel = 2;
            if(p.type === 'S') player.shield = true;
            powerups.splice(i, 1);
            score += 5;
        }
    });

    // 粒子更新
    particles.forEach((p, i) => {
        p.x += p.vx;
        p.y += p.vy;
        p.life--;
        if(p.life <= 0) particles.splice(i, 1);
    });
}

// 绘制界面
function draw() {
    ctx.fillStyle = '#050505';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // 绘制背景繁星
    ctx.fillStyle = '#fff';
    for(let i=0; i<10; i++) ctx.fillRect(Math.random()*canvas.width, (frame + i*60)%canvas.height, 2, 2);

    // 绘制玩家
    ctx.fillStyle = player.shield ? '#ff0' : '#0af';
    ctx.fillRect(player.x, player.y + 10, player.w, player.h - 10);
    ctx.fillRect(player.x + 15, player.y, 10, 10); // 机头
    if(player.shield) {
        ctx.strokeStyle = '#fff';
        ctx.strokeRect(player.x-5, player.y-5, player.w+10, player.h+10);
    }

    // 绘制子弹
    bullets.forEach(b => {
        ctx.fillStyle = b.color;
        ctx.fillRect(b.x, b.y, b.w, b.h);
    });

    // 绘制敌人
    enemies.forEach(en => {
        ctx.fillStyle = en.color;
        ctx.fillRect(en.x, en.y, en.w, en.h);
        ctx.fillStyle = 'rgba(255,255,255,0.3)';
        ctx.fillRect(en.x + 5, en.y + 5, 5, 5); // 装饰
    });

    // 绘制补给
    powerups.forEach(p => {
        ctx.fillStyle = p.type === 'W' ? '#f0f' : '#ff0';
        ctx.fillRect(p.x, p.y, p.w, p.h);
        ctx.fillStyle = '#000';
        ctx.fillText(p.type, p.x + 4, p.y + 12);
    });

    // 绘制粒子
    particles.forEach(p => {
        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.life / 20;
        ctx.fillRect(p.x, p.y, 3, 3);
    });
    ctx.globalAlpha = 1;

    // UI
    ctx.fillStyle = '#fff';
    ctx.font = '20px Arial';
    ctx.fillText(`SCORE: ${score}`, 10, 30);
}

function endGame() {
    gameActive = false;
    finalScoreText.innerText = `SCORE: ${score}`;
    gameOverScreen.style.display = 'block';
}

function animate() {
    if(!gameActive) return;
    update();
    draw();
    requestAnimationFrame(animate);
}

// 点击开始
startScreen.onclick = init;
gameOverScreen.onclick = init;

</script>
</body>
</html>
